<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>FlowOps — Demo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body { font-family: system-ui, sans-serif; max-width: 700px; margin: 40px auto; padding: 0 16px; }
    textarea { width: 100%; height: 150px; margin: 10px 0; }
    button { margin-right: 10px; padding: 10px 20px; border: 0; border-radius: 8px; background: #6B46C1; color: white; cursor: pointer; }
    button:hover { opacity: 0.9; }

    /* Navbar */
    nav { display:flex; justify-content:space-between; align-items:center; padding:14px 20px; border-bottom:1px solid #eee; margin: -24px -16px 24px; }
    nav a { color: inherit; text-decoration: none; margin-left: 12px; }

    /* Output card: مخفي افتراضيًا ويظهر عند وجود نص */
    #output{
      display:none;
      background:#fff;
      border:1px solid #eee;
      border-radius:12px;
      padding:14px;
      line-height:1.6;
      box-shadow:0 2px 8px rgba(0,0,0,.04);
      margin-top:12px;
      white-space:pre-line;
    }
    #output.show{ display:block; }
  </style>
</head>
<body>
  <!-- Navbar -->
  <nav>
    <div style="font-weight:700">FlowOps</div>
    <div>
      <a href="/index.html">Home</a>
      <a href="/pricing.html">Pricing</a>
      <span style="opacity:.5; margin-left:12px;">Try Demo</span>
    </div>
  </nav>

  <h2>💬 FlowOps — WhatsApp Message Optimizer</h2>
  <textarea id="input" placeholder="Type or paste your WhatsApp message here..."></textarea><br>
  <button onclick="analyze()">Cost analysis</button>
  <button onclick="compress()">AI compression</button>

  <!-- Output (كارد أنيق) -->
  <div id="output"></div>

  <script>
  // Helper لإظهار/إخفاء صندوق المخرجات
  function setOut(text){
    const el = document.getElementById('output');
    if (text && text.trim()){
      el.textContent = text;
      el.classList.add('show');
    } else {
      el.textContent = '';
      el.classList.remove('show');
    }
  }

  async function analyze() {
    const text = document.getElementById("input").value;
    const words = text.trim() ? text.trim().split(/\s+/).length : 0;
    const msgs = Math.max(1, Math.ceil(words / 70));
    const cost = (msgs * 0.03).toFixed(2);
    setOut(`📨 Number of messages: ${msgs}\n💵 Estimated cost: $${cost}`);
  }

  async function compress() {
    const text = document.getElementById("input").value.trim();
    if (!text) { setOut("Please write a message first."); return; }
    setOut("⏳ Compressing with AI...");
    try {
      const res = await fetch("/api/compress", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ text })
      });
      const data = await res.json();
      if (!res.ok) throw new Error(data.error || "API error");
      setOut(data.content || "(No output)");
    } catch (err) {
      setOut("Error: " + (err.message || "Processing failed"));
    }
  }
  </script>
</body>
</html>
