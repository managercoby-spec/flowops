<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>FlowOps ‚Äî Demo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body { font-family: system-ui, sans-serif; max-width: 700px; margin: 40px auto; padding: 0 16px; }
    textarea { width: 100%; min-height: 150px; margin: 10px 0; resize: vertical; }
    button { margin-right: 10px; padding: 10px 20px; border: 0; border-radius: 8px; background: #6B46C1; color: white; cursor: pointer; }
    button.secondary { background:#eee; color:inherit; }
    button[disabled] { opacity:.6; cursor:not-allowed; }

    /* Navbar */
    nav { display:flex; justify-content:space-between; align-items:center; padding:14px 20px; border-bottom:1px solid #eee; margin: -24px -16px 24px; }
    nav a { color: inherit; text-decoration: none; margin-left: 12px; }

    /* Output card */
    #outputWrap{ display:none; margin-top:12px; }
    #output{
      background:#fff; border:1px solid #eee; border-radius:12px; padding:14px; line-height:1.6;
      box-shadow:0 2px 8px rgba(0,0,0,.04); white-space:pre-line;
    }
    .toolbar{ display:flex; justify-content:space-between; align-items:center; margin-top:8px; }
    .muted{ opacity:.65; font-size:12px; }
  </style>

  <!-- favicon -->
  <link rel="icon" href="/favicon.svg" type="image/svg+xml">
  <meta name="theme-color" content="#6B46C1">
</head>
<body>
  <!-- Navbar -->
  <nav>
    <div style="display:flex;align-items:center;gap:8px;font-weight:700">
      <img src="/logo.svg" alt="FlowOps" width="22" height="22" style="display:block">
      FlowOps
    </div>
    <div>
      <a href="/index.html">Home</a>
      <a href="/pricing.html">Pricing</a>
      <span style="opacity:.5; margin-left:12px;">Try Demo</span>
    </div>
  </nav>

  <h2>üí¨ FlowOps ‚Äî WhatsApp Message Optimizer</h2>
  <textarea id="input" placeholder="Type or paste your WhatsApp message here..."></textarea><br>

  <div style="display:flex; gap:8px; margin-bottom:6px;">
    <button id="btnAnalyze" class="secondary" onclick="analyze()">Cost analysis</button>
    <button id="btnCompress" onclick="compress()">AI compression</button>
  </div>
  <div class="muted">Tip: Press <b>Ctrl/‚åò + Enter</b> to run AI compression, <b>Alt + A</b> for cost analysis.</div>

  <!-- Output + toolbar -->
  <div id="outputWrap">
    <div id="output"></div>
    <div class="toolbar">
      <span class="muted" id="status"></span>
      <button class="secondary" id="copyBtn" onclick="copyOut()">Copy</button>
    </div>
  </div>

  <script>
  // --- helpers ---
  const ta = document.getElementById('input');
  const out = document.getElementById('output');
  const wrap = document.getElementById('outputWrap');
  const statusEl = document.getElementById('status');
  const btnAnalyze = document.getElementById('btnAnalyze');
  const btnCompress = document.getElementById('btnCompress');

  function show(text, status='') {
    if (text && text.trim()) {
      out.textContent = text;
      wrap.style.display = 'block';
    } else {
      out.textContent = '';
      wrap.style.display = 'none';
    }
    statusEl.textContent = status;
  }

  function setLoading(on) {
    btnAnalyze.disabled = on;
    btnCompress.disabled = on;
  }

  async function copyOut() {
    try {
      await navigator.clipboard.writeText(out.textContent || '');
      statusEl.textContent = 'Copied';
      setTimeout(()=> statusEl.textContent = '', 1200);
    } catch {
      statusEl.textContent = 'Copy failed';
      setTimeout(()=> statusEl.textContent = '', 1200);
    }
  }

  // auto-resize textarea
  function autosize() {
    ta.style.height = 'auto';
    ta.style.height = Math.min(480, Math.max(150, ta.scrollHeight)) + 'px';
  }
  ta.addEventListener('input', autosize);
  window.addEventListener('load', autosize);

  // keyboard shortcuts
  window.addEventListener('keydown', (e) => {
    if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') { e.preventDefault(); compress(); }
    if (e.altKey && (e.key.toLowerCase() === 'a')) { e.preventDefault(); analyze(); }
  });

  // --- core actions ---
  async function analyze() {
    const text = ta.value;
    const words = text.trim() ? text.trim().split(/\s+/).length : 0;
    const msgs = Math.max(1, Math.ceil(words / 70));
    const cost = (msgs * 0.03).toFixed(2);
    show(`üì® Number of messages: ${msgs}\nüíµ Estimated cost: $${cost}`);
  }

  async function compress() {
    const text = ta.value.trim();
    if (!text) { show('Please write a message first.'); return; }
    setLoading(true);
    show('‚è≥ Compressing with AI...', 'Working‚Ä¶');
    try {
      const res = await fetch('/api/compress', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ text })
      });
      const data = await res.json();
      if (!res.ok) throw new Error(data.error || 'API error');
      show(data.content || '(No output)');
    } catch (err) {
      show('Error: ' + (err.message || 'Processing failed'));
    } finally {
      setLoading(false);
    }
  }
  </script>
</body>
</html>
