<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>FlowOps ‚Äî Demo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    /* Theme vars */
    :root{
      --bg:#ffffff; --text:#111827; --muted:#6b7280; --card:#ffffff; --border:#e5e7eb; --accent:#6B46C1; --shadow:0 2px 8px rgba(0,0,0,.04);
    }
    body.dark{
      --bg:#0b0f16; --text:#e5e7eb; --muted:#9ca3af; --card:#0f1520; --border:#1f2937; --accent:#8b5cf6; --shadow:0 2px 12px rgba(0,0,0,.35);
    }

    body { background:var(--bg); color:var(--text); font-family: system-ui, sans-serif; max-width: 700px; margin: 40px auto; padding: 0 16px; transition: background .2s,color .2s; }
    textarea { width: 100%; min-height: 150px; margin: 10px 0; resize: vertical; background:var(--card); color:var(--text); border:1px solid var(--border); border-radius:8px; padding:10px; }
    button { margin-right: 10px; padding: 10px 20px; border: 0; border-radius: 8px; background: var(--accent); color: white; cursor: pointer; }
    button.secondary { background:var(--border); color:var(--text); }
    button[disabled] { opacity:.6; cursor:not-allowed; }

    /* Navbar */
    nav { display:flex; justify-content:space-between; align-items:center; padding:14px 20px; border-bottom:1px solid var(--border); margin: -24px -16px 24px; }
    nav a { color: inherit; text-decoration: none; margin-left: 12px; }
    .theme { background:transparent; color:var(--text); border:1px solid var(--border); padding:8px 12px; border-radius:8px; }

    /* stats */
    .stats{display:flex;gap:14px;align-items:center;margin:6px 0 12px 0;font-size:13px;color:var(--muted)}
    .stats .dot{width:6px;height:6px;border-radius:999px;background:var(--accent);display:inline-block;margin:0 6px}

    /* Output card */
    #outputWrap{ display:none; margin-top:12px; }
    #output{
      background:var(--card); border:1px solid var(--border); border-radius:12px; padding:14px; line-height:1.6;
      box-shadow:var(--shadow); white-space:pre-line; color:var(--text);
    }
    .toolbar{ display:flex; justify-content:space-between; align-items:center; margin-top:8px; }
    .muted{ color:var(--muted); font-size:12px; }
  </style>

  <link rel="icon" href="/favicon.svg" type="image/svg+xml">
  <meta name="theme-color" content="#6B46C1">
</head>
<body>
  <!-- Navbar -->
  <nav>
    <div style="display:flex;align-items:center;gap:8px;font-weight:700">
      <img src="/logo.svg" alt="FlowOps" width="22" height="22" style="display:block">
      FlowOps
    </div>
    <div style="display:flex;align-items:center;gap:10px">
      <a href="/index.html">Home</a>
      <a href="/pricing.html">Pricing</a>
      <span style="opacity:.5;">Try Demo</span>
      <button class="theme" id="themeBtn" title="Toggle theme">üåô</button>
    </div>
  </nav>

  <h2>üí¨ FlowOps ‚Äî WhatsApp Message Optimizer</h2>
  <textarea id="input" placeholder="Type or paste your WhatsApp message here..."></textarea><br>

  <!-- live stats -->
  <div class="stats">
    <span><b id="sWords">0</b> words</span><span class="dot"></span>
    <span><b id="sChars">0</b> chars</span><span class="dot"></span>
    <span><b id="sMsgs">0</b> msgs</span><span class="dot"></span>
    <span>~$<b id="sCost">0.00</b></span>
  </div>

  <div style="display:flex; gap:8px; margin-bottom:6px;">
    <button id="btnAnalyze" class="secondary" onclick="analyze()">Cost analysis</button>
    <button id="btnCompress" onclick="compress()">AI compression</button>
  </div>
  <div class="muted">Tip: Press <b>Ctrl/‚åò + Enter</b> to run AI compression, <b>Alt + A</b> for cost analysis.</div>

  <!-- Output + toolbar -->
  <div id="outputWrap">
    <div id="output"></div>
    <div class="toolbar">
      <span class="muted" id="status"></span>
      <div>
        <button class="secondary" id="copyBtn" onclick="copyOut()">Copy</button>
        <button class="secondary" id="dlBtn" onclick="downloadTxt()">Download .txt</button>
      </div>
    </div>
  </div>

  <script>
  // --- refs ---
  const ta = document.getElementById('input');
  const out = document.getElementById('output');
  const wrap = document.getElementById('outputWrap');
  const statusEl = document.getElementById('status');
  const btnAnalyze = document.getElementById('btnAnalyze');
  const btnCompress = document.getElementById('btnCompress');
  const themeBtn = document.getElementById('themeBtn');

  // --- theme ---
  function applyTheme(t){ document.body.classList.toggle('dark', t==='dark'); themeBtn.textContent = t==='dark' ? '‚òÄÔ∏è' : 'üåô'; localStorage.setItem('theme', t); }
  (function initTheme(){
    const saved = localStorage.getItem('theme');
    const systemDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
    applyTheme(saved || (systemDark ? 'dark' : 'light'));
  })();
  themeBtn.addEventListener('click', () => {
    const t = document.body.classList.contains('dark') ? 'light' : 'dark';
    applyTheme(t);
  });

  // --- helpers ---
  function show(text, status='') {
    if (text && text.trim()) {
      out.textContent = text;
      wrap.style.display = 'block';
    } else {
      out.textContent = '';
      wrap.style.display = 'none';
    }
    statusEl.textContent = status;
  }

  function setLoading(on) {
    btnAnalyze.disabled = on;
    btnCompress.disabled = on;
  }

  async function copyOut() {
    try {
      await navigator.clipboard.writeText(out.textContent || '');
      statusEl.textContent = 'Copied';
      setTimeout(()=> statusEl.textContent = '', 1200);
    } catch {
      statusEl.textContent = 'Copy failed';
      setTimeout(()=> statusEl.textContent = '', 1200);
    }
  }

  function downloadTxt(){
    const txt = out.textContent || '';
    const blob = new Blob([txt], {type:'text/plain;charset=utf-8'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url; a.download = 'flowops-output.txt';
    document.body.appendChild(a); a.click(); a.remove();
    URL.revokeObjectURL(url);
  }

  // auto-resize textarea
  function autosize() {
    ta.style.height = 'auto';
    ta.style.height = Math.min(480, Math.max(150, ta.scrollHeight)) + 'px';
  }
  ta.addEventListener('input', autosize);
  window.addEventListener('load', autosize);

  // keyboard shortcuts
  window.addEventListener('keydown', (e) => {
    if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') { e.preventDefault(); compress(); }
    if (e.altKey && (e.key.toLowerCase() === 'a')) { e.preventDefault(); analyze(); }
  });

  // --- core actions ---
  async function analyze() {
    const text = ta.value;
    const words = text.trim() ? text.trim().split(/\s+/).length : 0;

    let msgs, cost;
    if (words === 0) {
      msgs = 0; cost = '0.00';
    } else {
      msgs = Math.max(1, Math.ceil(words / 70));
      cost = (msgs * 0.03).toFixed(2);
    }
    show(`üì® Number of messages: ${msgs}\nüíµ Estimated cost: $${cost}`);
  }

  async function compress() {
    const text = ta.value.trim();
    if (!text) { show('Please write a message first.'); return; }
    setLoading(true);
    show('‚è≥ Compressing with AI...', 'Working‚Ä¶');
    try {
      const res = await fetch('/api/compress', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ text })
      });
      const data = await res.json();
      if (!res.ok) throw new Error(data.error || 'API error');
      show(data.content || '(No output)');
    } catch (err) {
      show('Error: ' + (err.message || 'Processing failed'));
    } finally {
      setLoading(false);
    }
  }

  // --- live stats ---
  function updateStats(){
    const t = ta.value;
    const words = t.trim() ? t.trim().split(/\s+/).length : 0;
    const chars = t.length;

    let msgs, cost;
    if (words === 0) { msgs = 0; cost = '0.00'; }
    else { msgs = Math.max(1, Math.ceil(words / 70)); cost = (msgs * 0.03).toFixed(2); }

    document.getElementById('sWords').textContent = words;
    document.getElementById('sChars').textContent = chars;
    document.getElementById('sMsgs').textContent  = msgs;
    document.getElementById('sCost').textContent  = cost;
  }
  ta.addEventListener('input', updateStats);
  window.addEventListener('load', updateStats);
  </script>
</body>
</html>
