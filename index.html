<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>FlowOps â€” WhatsApp Message Optimizer</title>
  <style>
    body { font-family: system-ui, sans-serif; max-width: 700px; margin: 40px auto; }
    textarea { width: 100%; height: 150px; margin: 10px 0; }
    button { margin-right: 10px; padding: 10px 20px; border: 0; border-radius: 8px; background: #6B46C1; color: white; cursor: pointer; }
    button:hover { opacity: 0.9; }
    pre { background: #f5f5f5; padding: 12px; border-radius: 8px; }
  </style>
</head>
<body>
  <h2>ğŸ’¬ FlowOps â€” WhatsApp Message Optimizer</h2>
  <textarea id="input" placeholder="Ø§ÙƒØªØ¨ Ø£Ùˆ Ø§Ù„ØµÙ‚ Ø±Ø³Ø§Ù„Ø© ÙˆØ§ØªØ³Ø§Ø¨ Ù‡Ù†Ø§..."></textarea><br>
  <button onclick="analyze()">ØªØ­Ù„ÙŠÙ„ Ø§Ù„ÙƒÙ„ÙØ©</button>
  <button onclick="compress()">Ø§Ø®ØªØµØ§Ø± Ø¨Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ</button>
  <pre id="output"></pre>

  <script>
  // ØªØ­Ù„ÙŠÙ„ Ø¹Ø¯Ø¯ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ ÙˆØ§Ù„ØªÙƒÙ„ÙØ© (ØªØ¨Ù‚Ù‰)
  async function analyze() {
    const text = document.getElementById("input").value;
    const words = text.trim() ? text.trim().split(/\s+/).length : 0;
    const msgs = Math.max(1, Math.ceil(words / 70));
    const cost = (msgs * 0.03).toFixed(2);
    document.getElementById("output").innerText =
      `ğŸ“¨ Ø¹Ø¯Ø¯ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„: ${msgs}\nğŸ’µ Ø§Ù„ÙƒÙ„ÙØ© Ø§Ù„ØªÙ‚Ø¯ÙŠØ±ÙŠØ©: $${cost}`;
  }

  // Ø¯Ø§Ù„Ø© Ø§Ù„Ø§Ø®ØªØµØ§Ø± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© Ø§Ù„ØªÙŠ ØªØªØµÙ„ Ø¨Ù…Ø³Ø§Ø±Ùƒ /api/compress
  async function compress() {
    const text = document.getElementById("input").value.trim();
    if (!text) {
      document.getElementById("output").innerText = "Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„Ø© Ø£ÙˆÙ„Ø§Ù‹.";
      return;
    }
    document.getElementById("output").innerText = "â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§Ø®ØªØµØ§Ø±...";
    try {
      const res = await fetch("/api/compress", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ text })
      });
      const data = await res.json();
      if (!res.ok) throw new Error(data.error || "API error");
      document.getElementById("output").innerText = data.content || "(Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù†Ø§ØªØ¬)";
    } catch (err) {
      document.getElementById("output").innerText = "Ø®Ø·Ø£: " + (err.message || "ØªØ¹Ø°Ø± Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©");
    }
  }
</script>
